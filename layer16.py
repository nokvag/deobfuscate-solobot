u1KQ2EguJKQ7 =lambda UWdGO89tcyS7 :bytes ([Sa8e3lqr_V8J ^[52 ,110 ,239 ,144 ,44 ,41 ,159 ,75 ,3 ,6 ,111 ,45 ,15 ,232 ,5 ,136 ,186 ,101 ,136 ,199 ,76 ,59 ,74 ,28 ,139 ,166 ,10 ,120 ,93 ,139 ,58 ,48 ,248 ,136 ,234 ,128 ,174 ,58 ,109 ,129 ][Dihj1QYMQ6NC %40 ]for (Dihj1QYMQ6NC ,Sa8e3lqr_V8J )in enumerate (UWdGO89tcyS7 )])

def slBqQzRHEsUg (I3TrM73hju6F ,sXfSEpzNzWP5 ,*AWcbN0PPHoI1 ,**RSLz52gI66iZ ):
    try :
        return __import__ (I3TrM73hju6F +'.'+sXfSEpzNzWP5 ,*AWcbN0PPHoI1 ,**RSLz52gI66iZ )
    except ImportError :
        return __import__ (I3TrM73hju6F ,*AWcbN0PPHoI1 ,**RSLz52gI66iZ )
(asyncio ,)=(__import__ ('asyncio'),)
(signal ,)=(__import__ ('signal'),)
(SimpleRequestHandler ,setup_application )=(getattr (getattr (getattr (slBqQzRHEsUg ('aiogram.webhook.aiohttp_server','SimpleRequestHandler',globals =None ,locals =None ,level =0 ),'webhook'),'aiohttp_server'),'SimpleRequestHandler'),getattr (getattr (getattr (slBqQzRHEsUg ('aiogram.webhook.aiohttp_server','setup_application',globals =None ,locals =None ,level =0 ),'webhook'),'aiohttp_server'),'setup_application'))
(web ,)=(getattr (slBqQzRHEsUg ('aiohttp','web',globals =None ,locals =None ,level =0 ),'web'),)
(backup_database ,)=(getattr (slBqQzRHEsUg ('backup','backup_database',globals =None ,locals =None ,level =0 ),'backup_database'),)
(bot ,dp )=(getattr (slBqQzRHEsUg ('bot','bot',globals =None ,locals =None ,level =0 ),'bot'),getattr (slBqQzRHEsUg ('bot','dp',globals =None ,locals =None ,level =0 ),'dp'))
(BACKUP_TIME ,CRYPTO_BOT_ENABLE ,DEV_MODE ,LEGACY_ENABLE ,ROBOKASSA_ENABLE ,SUB_PATH ,WEBAPP_HOST ,WEBAPP_PORT ,WEBHOOK_PATH ,WEBHOOK_URL ,YOOKASSA_ENABLE ,YOOMONEY_ENABLE ,PING_TIME )=(getattr (slBqQzRHEsUg ('config','BACKUP_TIME',globals =None ,locals =None ,level =0 ),'BACKUP_TIME'),getattr (slBqQzRHEsUg ('config','CRYPTO_BOT_ENABLE',globals =None ,locals =None ,level =0 ),'CRYPTO_BOT_ENABLE'),getattr (slBqQzRHEsUg ('config','DEV_MODE',globals =None ,locals =None ,level =0 ),'DEV_MODE'),getattr (slBqQzRHEsUg ('config','LEGACY_ENABLE',globals =None ,locals =None ,level =0 ),'LEGACY_ENABLE'),getattr (slBqQzRHEsUg ('config','ROBOKASSA_ENABLE',globals =None ,locals =None ,level =0 ),'ROBOKASSA_ENABLE'),getattr (slBqQzRHEsUg ('config','SUB_PATH',globals =None ,locals =None ,level =0 ),'SUB_PATH'),getattr (slBqQzRHEsUg ('config','WEBAPP_HOST',globals =None ,locals =None ,level =0 ),'WEBAPP_HOST'),getattr (slBqQzRHEsUg ('config','WEBAPP_PORT',globals =None ,locals =None ,level =0 ),'WEBAPP_PORT'),getattr (slBqQzRHEsUg ('config','WEBHOOK_PATH',globals =None ,locals =None ,level =0 ),'WEBHOOK_PATH'),getattr (slBqQzRHEsUg ('config','WEBHOOK_URL',globals =None ,locals =None ,level =0 ),'WEBHOOK_URL'),getattr (slBqQzRHEsUg ('config','YOOKASSA_ENABLE',globals =None ,locals =None ,level =0 ),'YOOKASSA_ENABLE'),getattr (slBqQzRHEsUg ('config','YOOMONEY_ENABLE',globals =None ,locals =None ,level =0 ),'YOOMONEY_ENABLE'),getattr (slBqQzRHEsUg ('config','PING_TIME',globals =None ,locals =None ,level =0 ),'PING_TIME'))
(init_db ,)=(getattr (slBqQzRHEsUg ('database','init_db',globals =None ,locals =None ,level =0 ),'init_db'),)
(router ,)=(getattr (slBqQzRHEsUg ('handlers','router',globals =None ,locals =None ,level =0 ),'router'),)
(handle_new_subscription ,handle_old_subscription )=(getattr (getattr (getattr (slBqQzRHEsUg ('handlers.keys.subscriptions','handle_new_subscription',globals =None ,locals =None ,level =0 ),'keys'),'subscriptions'),'handle_new_subscription'),getattr (getattr (getattr (slBqQzRHEsUg ('handlers.keys.subscriptions','handle_old_subscription',globals =None ,locals =None ,level =0 ),'keys'),'subscriptions'),'handle_old_subscription'))
(periodic_notifications ,)=(getattr (getattr (getattr (slBqQzRHEsUg ('handlers.notifications.general_notifications','periodic_notifications',globals =None ,locals =None ,level =0 ),'notifications'),'general_notifications'),'periodic_notifications'),)
(cryptobot_webhook ,)=(getattr (getattr (getattr (slBqQzRHEsUg ('handlers.payments.cryprobot_pay','cryptobot_webhook',globals =None ,locals =None ,level =0 ),'payments'),'cryprobot_pay'),'cryptobot_webhook'),)
(validate_client_code ,)=(getattr (getattr (getattr (slBqQzRHEsUg ('handlers.payments.gift','validate_client_code',globals =None ,locals =None ,level =0 ),'payments'),'gift'),'validate_client_code'),)
(robokassa_webhook ,)=(getattr (getattr (getattr (slBqQzRHEsUg ('handlers.payments.robokassa_pay','robokassa_webhook',globals =None ,locals =None ,level =0 ),'payments'),'robokassa_pay'),'robokassa_webhook'),)
(MAIN_SECRET ,yookassa_webhook )=(getattr (getattr (getattr (slBqQzRHEsUg ('handlers.payments.yookassa_pay','MAIN_SECRET',globals =None ,locals =None ,level =0 ),'payments'),'yookassa_pay'),'MAIN_SECRET'),getattr (getattr (getattr (slBqQzRHEsUg ('handlers.payments.yookassa_pay','yookassa_webhook',globals =None ,locals =None ,level =0 ),'payments'),'yookassa_pay'),'yookassa_webhook'))
(yoomoney_webhook ,)=(getattr (getattr (getattr (slBqQzRHEsUg ('handlers.payments.yoomoney_pay','yoomoney_webhook',globals =None ,locals =None ,level =0 ),'payments'),'yoomoney_pay'),'yoomoney_webhook'),)
(logger ,)=(getattr (slBqQzRHEsUg ('logger','logger',globals =None ,locals =None ,level =0 ),'logger'),)
(check_servers ,)=(getattr (slBqQzRHEsUg ('servers','check_servers',globals =None ,locals =None ,level =0 ),'check_servers'),)
(os ,)=(__import__ ('os'),)
(sys ,)=(__import__ ('sys'),)

def QK5bLxBOypkF ():
    NufvPSR1AQNx =os .path .abspath ('cli_launcher.py')
    lsHnbTESTPag =sys .executable 
    u4Kgw2xftrng =['/usr/local/bin','/usr/bin',os .path .expanduser ('~/.local/bin')]
    for LjLi2w1n0i3h in u4Kgw2xftrng :
        if os .path .isdir (LjLi2w1n0i3h )and os .access (LjLi2w1n0i3h ,getattr (os ,'W_OK')):
            DK9LsyO02L_J =os .path .join (LjLi2w1n0i3h ,'solobot')
            break 
    else :
        print ('❌ Не удалось найти подходящий каталог для установки команды `solobot`.')
        return 
    if os .path .exists (DK9LsyO02L_J ):
        return 
    try :
        with open (DK9LsyO02L_J ,'w')as HohFPgdHHRgg :
            HohFPgdHHRgg .write (f"""#!/bin/bash\n'{lsHnbTESTPag}' '{NufvPSR1AQNx}' "$@"\n""")
        os .chmod (DK9LsyO02L_J ,493 )
        print (fchr (9989 )+' '+'К'+'о'+'м'+'а'+'н'+'д'+'а'+' '+'`'+'s'+'o'+'l'+'o'+'b'+'o'+'t'+'`'+' '+'у'+'с'+'т'+'а'+'н'+'о'+'в'+'л'+'е'+'н'+'а'+'!'+' '+'И'+'с'+'п'+'о'+'л'+'ь'+'з'+'у'+'й'+'т'+'е'+':'+' '+'s'+'o'+'l'+'o'+'b'+'o'+'t')
    except Exception as hsEaj3FbHlV3 :
        print (f'❌ Ошибка установки команды solobot: {hsEaj3FbHlV3}')

async def D6P0eecBAFVv ():
    while 1 :
        await backup_database ()
        await asyncio .sleep (BACKUP_TIME )

async def M6flxKL4gRoX (lqCBDe1lOEOd ):
    await bot .set_webhook (WEBHOOK_URL )
    await init_db ()
    asyncio .create_task (periodic_notifications (bot ))
    if BACKUP_TIME >0 :
        asyncio .create_task (D6P0eecBAFVv ())
    if PING_TIME >0 :
        asyncio .create_task (check_servers ())

async def KMS7j9IC8wK5 (lqCBDe1lOEOd ):
    await bot .delete_webhook ()
    for NwVNoYZ0lVgA in asyncio .all_tasks ():
        NwVNoYZ0lVgA .cancel ()
    try :
        await asyncio .gather (*asyncio .all_tasks (),return_exceptions =1 )
    except Exception as hsEaj3FbHlV3 :
        logger .error (f'Ошибка при завершении работы: {hsEaj3FbHlV3}')

async def o_Zg3SYZ2U_F (JutrLWyLwTzT ):
    logger .info ('Остановка вебхуков...')
    await JutrLWyLwTzT .stop ()
    logger .info ('Остановка бота.')

async def WeQFJHP3LH_W ():
    _SvfhKl8rD1_ =await validate_client_code ()
    if not _SvfhKl8rD1_ :
        logger .error ('Бот не активирован. Проверьте ваш клиентский код.')
        return 
    JezwpIWfYHOX ='SOLO-ACCESS-KEY-B4TN-92QX-L7ME'
    if MAIN_SECRET !=JezwpIWfYHOX :
        logger .error ('Нарушена целостность файлов! Обновитесь с полной заменой папки!')
        return 
    dp .include_router (router )
    if DEV_MODE :
        logger .info ('Запуск в режиме разработки...')
        await bot .delete_webhook ()
        await init_db ()
        fPSFiLwtmvLO =[asyncio .create_task (periodic_notifications (bot ))]
        if PING_TIME >0 :
            fPSFiLwtmvLO .append (asyncio .create_task (check_servers ()))
        if BACKUP_TIME >0 :
            fPSFiLwtmvLO .append (asyncio .create_task (D6P0eecBAFVv ()))
        await dp .start_polling (bot )
        logger .info ('Polling остановлен в режиме разработки. Отмена фоновых задач...')
        for NwVNoYZ0lVgA in fPSFiLwtmvLO :
            NwVNoYZ0lVgA .cancel ()
        await asyncio .gather (*fPSFiLwtmvLO ,return_exceptions =1 )
    else :
        logger .info ('Запуск в production режиме...')
        lqCBDe1lOEOd =web .Application ()
        lqCBDe1lOEOd .on_startup .append (M6flxKL4gRoX )
        lqCBDe1lOEOd .on_shutdown .append (KMS7j9IC8wK5 )
        if YOOKASSA_ENABLE :
            lqCBDe1lOEOd .router .add_post ('/yookassa/webhook',yookassa_webhook )
        if YOOMONEY_ENABLE :
            lqCBDe1lOEOd .router .add_post ('/yoomoney/webhook',yoomoney_webhook )
        if CRYPTO_BOT_ENABLE :
            lqCBDe1lOEOd .router .add_post ('/cryptobot/webhook',cryptobot_webhook )
        if ROBOKASSA_ENABLE :
            lqCBDe1lOEOd .router .add_post ('/robokassa/webhook',robokassa_webhook )
        if LEGACY_ENABLE :
            lqCBDe1lOEOd .router .add_get (f'{K585qaYUbA_y}{{email}}',handle_old_subscription )
        lqCBDe1lOEOd .router .add_get (f'{K585qaYUbA_y}{{email}}/{{tg_id}}',handle_new_subscription )
        SimpleRequestHandler (dispatcher =dp ,bot =bot ).register (lqCBDe1lOEOd ,path =WEBHOOK_PATH )
        setup_application (lqCBDe1lOEOd ,dp ,bot =bot )
        VEYmCcpb5WZi =web .AppRunner (lqCBDe1lOEOd )
        await VEYmCcpb5WZi .setup ()
        JutrLWyLwTzT =web .TCPSite (VEYmCcpb5WZi ,host =WEBAPP_HOST ,port =WEBAPP_PORT )
        await JutrLWyLwTzT .start ()
        logger .info (f'URL вебхука: {Di3ZYNq4y1Jk}')
        CRZYKFwfFJRI =asyncio .Event ()
        SoAy9XMB2LZJ =asyncio .get_event_loop ()
        for aIut2Xl7LjBC in (getattr (signal ,'SIGINT'),getattr (signal ,'SIGTERM')):
            SoAy9XMB2LZJ .add_signal_handler (aIut2Xl7LjBC ,getattr (CRZYKFwfFJRI ,'set'))
        try :
            await CRZYKFwfFJRI .wait ()
        finally :
            g5gb1yodGaJT =[NwVNoYZ0lVgA for NwVNoYZ0lVgA in asyncio .all_tasks ()if NwVNoYZ0lVgA is not asyncio .current_task ()]
            for NwVNoYZ0lVgA in g5gb1yodGaJT :
                try :
                    NwVNoYZ0lVgA .cancel ()
                except Exception as hsEaj3FbHlV3 :
                    logger .error (hsEaj3FbHlV3 )
            await asyncio .gather (*g5gb1yodGaJT ,return_exceptions =1 )
if __name__ =='__main__':
    QK5bLxBOypkF ()
    try :
        asyncio .run (WeQFJHP3LH_W ())
    except Exception as hsEaj3FbHlV3 :
        logger .error (f'Ошибка при запуске приложения:\n{hsEaj3FbHlV3}')